(function(e){function t(t){for(var r,o,l=t[0],s=t[1],c=t[2],d=0,f=[];d<l.length;d++)o=l[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&f.push(n[o][0]),n[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);u&&u(t);while(f.length)f.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],r=!0,l=1;l<a.length;l++){var s=a[l];0!==n[s]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=a[0]))}return e}var r={},n={app:0},i=[];function o(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=r,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(a,r,function(t){return e[t]}.bind(null,r));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var r=a("85ec"),n=a.n(r);n.a},1:function(e,t){},1020:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return c}));a("e260"),a("ace4"),a("e6cf"),a("25f0"),a("5319"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var r=a("1da1"),n=a("3452"),i=a("7907"),o=n.enc.Hex.parse("687a4852416d736f356b496e62617857"),l=n.enc.Hex.parse("2331346C6A6B5F215C5D2630553C2728"),s={mp3:"audio/mpeg",flac:"audio/flac"};function c(e){return u.apply(this,arguments)}function u(){return u=Object(r["a"])((function*(e){var t=yield new Promise(t=>{var a=new FileReader;a.onload=e=>{t(e.target.result)},a.readAsArrayBuffer(e)}),a=new DataView(t);if(1313166403!==a.getUint32(0,!0)||1296122950!==a.getUint32(4,!0))return{status:!1,message:"此ncm文件已损坏"};var r=10,c=(()=>{var e=a.getUint32(r,!0);r+=4;var i=new Uint8Array(t,r,e).map(e=>100^e);r+=e;for(var l=n.AES.decrypt({ciphertext:n.lib.WordArray.create(i)},o,{mode:n.mode.ECB,padding:n.pad.Pkcs7}),s=new Uint8Array(l.sigBytes),c=l.words,u=l.sigBytes,d=0;d<u;d++)s[d]=c[d>>>2]>>>24-d%4*8&255;return s.slice(17)})(),u=(()=>{for(var e=new Uint8Array(Array(256).keys()),t=c.length,a=0,r=0;r<256;r++)a=e[r]+a+c[r%t]&255,[e[r],e[a]]=[e[a],e[r]];return e.map((e,t,a)=>{t=t+1&255;var r=a[t],n=a[t+r&255];return a[r+n&255]})})(),d=(()=>{var e=a.getUint32(r,!0);if(r+=4,0===e)return{};var i=new Uint8Array(t,r,e).map(e=>99^e);r+=e;var o=n.AES.decrypt({ciphertext:n.enc.Base64.parse(n.lib.WordArray.create(i.slice(22)).toString(n.enc.Utf8))},l,{mode:n.mode.ECB,padding:n.pad.Pkcs7}),s=JSON.parse(o.toString(n.enc.Utf8).slice(6));return s.albumPic=s.albumPic.replace("http:","https:"),s})();r+=a.getUint32(r+5,!0)+13;for(var f=new Uint8Array(t,r),m=f.length,p=0;p<m;++p)f[p]^=u[255&p];if(void 0===d.format){var[h,b,g,v]=f;d.format=102===h&&76===b&&97===g&&67===v?"flac":"mp3"}var y=s[d.format],w=[];if(d.artist.forEach(e=>{w.push(e[0])}),"mp3"===d.format){var k=new i(f);if(k.setFrame("TPE1",w).setFrame("TIT2",d.musicName).setFrame("TALB",d.album),""!==d.albumPic)try{var x=yield(yield fetch(d.albumPic)).arrayBuffer();k.setFrame("APIC",{type:3,data:x,description:"Cover"})}catch(A){console.log("Fail to write cover image!")}k.addTag(),f=k.arrayBuffer}var _=new Blob([f],{type:y}),U=URL.createObjectURL(_),O=w.join(" & ")+" - "+d.musicName+"."+d.format;return{status:!0,filename:O,title:d.musicName,artist:w.join(" & "),album:d.album,picture:d.albumPic,file:U,mime:y}})),u.apply(this,arguments)}},2:function(e,t){},"56d7":function(e,t,a){"use strict";a.r(t);var r=a("2b0e"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("el-container",[a("el-main",[a("el-upload",{attrs:{"auto-upload":!1,"on-change":e.handleFile,"show-file-list":!1,action:"",drag:"",multiple:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击选择")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("本工具仅在浏览器内对文件进行解锁，无需消耗流量")])]),a("el-row",{attrs:{id:"app-control"}},[a("el-button",{attrs:{icon:"el-icon-download",plain:""},on:{click:e.handleDownloadAll}},[e._v("下载全部")]),a("el-button",{attrs:{icon:"el-icon-delete",plain:"",type:"danger"},on:{click:e.handleDeleteAll}},[e._v("删除全部")])],1),a("audio",{attrs:{autoplay:e.playing_auto,src:e.playing_url,controls:""}}),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"封面"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.row.picture}},[a("div",{staticClass:"image-slot el-image__error",attrs:{slot:"error"},slot:"error"},[e._v(" 暂无封面 ")])])]}}])}),a("el-table-column",{attrs:{label:"歌曲",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.title))])]}}])}),a("el-table-column",{attrs:{label:"歌手",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.artist))])]}}])}),a("el-table-column",{attrs:{label:"专辑",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.album))])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"success"},on:{click:function(a){return e.handlePlay(t.$index,t.row)}}}),a("el-button",{attrs:{circle:"",icon:"el-icon-download"},on:{click:function(a){return e.handleDownload(t.row)}}}),a("el-button",{attrs:{circle:"",icon:"el-icon-delete",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}})]}}])})],1)],1),a("el-footer",{attrs:{id:"app-footer"}},[a("el-row",[e._v(" 音乐解锁：移除已购音乐的加密保护。 目前支持网易云音乐(ncm)和QQ音乐(qmc0, qmc3, qmcflac, qmcogg, mflac)。 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music/wiki/使用提示",target:"_blank"}},[e._v("使用提示")])]),a("el-row",[a("span",[e._v("Copyright © 2019")]),a("a",{attrs:{href:"https://github.com/ix64",target:"_blank"}},[e._v("MengYX")]),e._v(" 音乐解锁使用 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/LICENSE",target:"_blank"}},[e._v("MIT许可协议")]),e._v(" 开放 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music",target:"_blank"}},[e._v("源代码")])])],1)],1)],1)},i=[],o=(a("e260"),a("ddb0"),a("2b3d"),a("1da1")),l=a("1020"),s=a("d26a"),c=a("b5de"),u=a("5fa2"),d={name:"app",components:{},data(){return{activeIndex:"1",tableData:[],playing_url:"",playing_auto:!1}},mounted(){this.$nextTick((function(){this.finishLoad()}))},methods:{finishLoad(){document.getElementById("loader-mask").remove(),this.$notify.info({title:"离线使用",message:'我们使用PWA技术，无网络也能使用<br/>最近更新：支持qmcogg,mflac<br/>点击查看 <a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:1e4,position:"top-left"})},handleFile(e){var t=this,a=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length).toLowerCase();Object(o["a"])((function*(){var r=null;switch(a){case"ncm":r=yield l.Decrypt(e.raw);break;case"mp3":case"flac":r=yield c.Decrypt(e.raw);break;case"qmc3":case"qmc0":case"qmcflac":case"qmcogg":r=yield s.Decrypt(e.raw);break;case"mflac":r=yield u.Decrypt(e.raw);break;default:r={status:!1,message:"不支持此文件格式"};break}if(r.status){t.tableData.push(r),t.$notify.success({title:"解锁成功",message:"成功解锁 "+r.title,duration:3e3});var n=[r.title,r.artist,r.album];console.log(r),window._paq.push(["trackEvent","Unlock",a+","+r.mime,JSON.stringify(n)])}else t.$notify.error({title:"出现问题",message:r.message+"，"+e.name+'，参考<a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:6e3}),window._paq.push(["trackEvent","Error",r.message,e.name])}))()},handlePlay(e,t){this.playing_url=t.file,this.playing_auto=!0},handleDelete(e,t){console.log(e),URL.revokeObjectURL(t.file),URL.revokeObjectURL(t.picture),this.tableData.splice(e,1)},handleDownload(e){var t=document.createElement("a");t.href=e.file,t.download=e.filename,document.body.append(t),t.click(),t.remove()},handleDeleteAll(){this.tableData.forEach(e=>{URL.revokeObjectURL(e.file),URL.revokeObjectURL(e.picture)}),this.tableData=[]},handleDownloadAll(){var e=0,t=setInterval(()=>{e<this.tableData.length?(this.handleDownload(this.tableData[e]),e++):clearInterval(t)},1e3)}}},f=d,m=(a("034f"),a("2877")),p=Object(m["a"])(f,n,i,!1,null,null,null),h=p.exports,b=a("9483");Object(b["a"])("".concat("","service-worker.js"),{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var g=a("5c96");a("0fae");r["default"].use(g["Link"]),r["default"].use(g["Image"]),r["default"].use(g["Button"]),r["default"].use(g["Table"]),r["default"].use(g["TableColumn"]),r["default"].use(g["Main"]),r["default"].use(g["Footer"]),r["default"].use(g["Container"]),r["default"].use(g["Icon"]),r["default"].use(g["Row"]),r["default"].use(g["Col"]),r["default"].use(g["Upload"]),r["default"].prototype.$notify=g["Notification"],r["default"].config.productionTip=!1,new r["default"]({render:e=>e(h)}).$mount("#app")},"5fa2":function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return o}));a("e260"),a("ace4"),a("e6cf"),a("1276"),a("498a"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var r=a("ade3"),n=a("1da1"),i=a("cb96");function o(e){return l.apply(this,arguments)}function l(){return l=Object(n["a"])((function*(e){var t=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length).toLowerCase();if("mflac"!==t)return{status:!1,message:"File type is incorrect!"};var a=yield new Promise(t=>{var a=new FileReader;a.onload=e=>{t(e.target.result)},a.readAsArrayBuffer(e)}),r=new Uint8Array(a.slice(0,-368)),n=r.length,o=new s;if(!o.DetectMask(r))return{status:!1,message:"此音乐无法解锁，目前mflac格式不提供完整支持"};for(var l=0;l<n;++l)r[l]^=o.NextMask();var c=new Blob([r],{type:"audio/flac"}),u=URL.createObjectURL(c),d=yield i.parseBlob(c),f=e.name.substring(0,e.name.lastIndexOf(".")).split("-"),m=d.common.title,p=d.common.artist;f.length>1?(void 0===p&&(p=f[0].trim()),void 0===m&&(m=f[1].trim())):1===f.length&&void 0===m&&(m=f[0].trim());var h=p+" - "+m+".flac",b="";if(void 0!==d.common.picture&&d.common.picture.length>=1){var g=d.common.picture[0],v=new Blob([g.data],{type:g.format});b=URL.createObjectURL(v)}return{status:!0,message:"",filename:h,title:m,artist:p,album:d.common.album,picture:b,file:u,mime:"audio/flac"}})),l.apply(this,arguments)}class s{constructor(){Object(r["a"])(this,"FLAC_HEADER",[102,76,97,67,0]),this.index=-1,this.mask_index=-1,this.mask=Array(128).fill(0)}DetectMask(e){for(var t,a=e.length-256,r=0;r<a;r+=128){var n=!0;t=e.slice(r,r+128);for(var i=e.slice(r+128,r+256),o=0;o<128;o++)if(t[o]!==i[o]){n=!1;break}if(n){for(var l=0;l<this.FLAC_HEADER.length;l++){var s=e[l]^t[l];if(s!==this.FLAC_HEADER[l]){n=!1;break}}if(n)return this.mask=t,!0}}return!1}NextMask(){return this.index++,this.mask_index++,(32768===this.index||this.index>32768&&(this.index+1)%32768===0)&&(this.index++,this.mask_index++),this.mask_index>=128&&(this.mask_index-=128),this.mask[this.mask_index]}}},"85ec":function(e,t,a){},b5de:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return o}));a("e260"),a("1276"),a("498a"),a("ddb0"),a("2b3d");var r=a("1da1"),n=a("cb96"),i={mp3:"audio/mpeg",flac:"audio/flac"};function o(e){return l.apply(this,arguments)}function l(){return l=Object(r["a"])((function*(e){var t=yield n.parseBlob(e),a="";if(void 0!==t.common.picture&&t.common.picture.length>0){var r=new Blob([t.common.picture[0].data],{type:t.common.picture[0].format});a=URL.createObjectURL(r)}var o=URL.createObjectURL(e),l=e.name.substring(0,e.name.lastIndexOf(".")),s=l.split("-"),c=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length).toLowerCase(),u=i[c],d=t.common.title,f=t.common.artist;s.length>1?(void 0===f&&(f=s[0].trim()),void 0===d&&(d=s[1].trim())):1===s.length&&void 0===d&&(d=s[0].trim());var m=f+" - "+d+"."+c;return{status:!0,filename:m,title:d,artist:f,album:t.common.album,picture:a,file:o,mime:u}})),l.apply(this,arguments)}},d26a:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return l}));a("e260"),a("ace4"),a("e6cf"),a("1276"),a("498a"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var r=a("1da1"),n=a("cb96"),i=[[74,214,202,144,103,247,82],[94,149,35,159,19,17,126],[71,116,61,144,170,63,81],[198,9,213,159,250,102,249],[243,214,161,144,160,247,240],[29,149,222,159,132,17,244],[14,116,187,144,188,63,146],[0,9,91,159,98,102,161]],o={mp3:"audio/mpeg",flac:"audio/flac",ogg:"audio/ogg"};function l(e){return s.apply(this,arguments)}function s(){return s=Object(r["a"])((function*(e){var t,a=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length).toLowerCase();switch(a){case"qmc0":case"qmc3":t="mp3";break;case"qmcogg":t="ogg";break;case"qmcflac":t="flac";break;default:return{status:!1,message:"File type is incorrect!"}}for(var r=o[t],i=yield new Promise(t=>{var a=new FileReader;a.onload=e=>{t(e.target.result)},a.readAsArrayBuffer(e)}),l=new Uint8Array(i),s=l.length,u=new c,d=0;d<s;++d)l[d]^=u.NextMask();var f=new Blob([l],{type:r}),m=URL.createObjectURL(f),p=yield n.parseBlob(f),h=e.name.substring(0,e.name.lastIndexOf(".")).split("-"),b=p.common.title,g=p.common.artist;h.length>1?(void 0===g&&(g=h[0].trim()),void 0===b&&(b=h[1].trim())):1===h.length&&void 0===b&&(b=h[0].trim());var v=g+" - "+b+"."+t,y="";if(void 0!==p.common.picture&&p.common.picture.length>=1){var w=p.common.picture[0],k=new Blob([w.data],{type:w.format});y=URL.createObjectURL(k)}return{status:!0,filename:v,title:b,artist:g,album:p.common.album,picture:y,file:m,mime:r}})),s.apply(this,arguments)}class c{constructor(){this.x=-1,this.y=8,this.dx=1,this.index=-1}NextMask(){var e;return this.index++,this.x<0?(this.dx=1,this.y=(8-this.y)%8,e=195):this.x>6?(this.dx=-1,this.y=7-this.y,e=216):e=i[this.y][this.x],this.x+=this.dx,32768===this.index||this.index>32768&&(this.index+1)%32768===0?this.NextMask():e}}}});
//# sourceMappingURL=app.54f956b4.js.map