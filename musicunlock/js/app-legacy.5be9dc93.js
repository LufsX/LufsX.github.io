(function(e){function t(t){for(var n,c,o=t[0],s=t[1],u=t[2],f=0,d=[];f<o.length;f++)c=o[f],Object.prototype.hasOwnProperty.call(a,c)&&a[c]&&d.push(a[c][0]),a[c]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);l&&l(t);while(d.length)d.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,o=1;o<r.length;o++){var s=r[o];0!==a[s]&&(n=!1)}n&&(i.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},a={app:0},i=[];function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],s=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=s;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("85ec"),a=r.n(n);a.a},"06dc":function(e,t,r){"use strict";r.r(t),r.d(t,"GetArrayBuffer",(function(){return a})),r.d(t,"GetFileInfo",(function(){return o})),r.d(t,"GetCoverURL",(function(){return s})),r.d(t,"AudioMimeType",(function(){return c}));r("d3b7"),r("ac1f"),r("3ca3"),r("1276"),r("498a"),r("ddb0"),r("2b3d"),r("96cf");var n=r("1da1");function a(e){return i.apply(this,arguments)}function i(){return i=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.readAsArrayBuffer(t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)}var c={mp3:"audio/mpeg",flac:"audio/flac",m4a:"audio/mp4",ogg:"audio/ogg"};function o(e,t,r,n){var a="",i="",c=r.split("-");c.length>1?(a=c[0].trim(),i=c[1].trim()):1===c.length&&(i=c[0].trim()),"string"==typeof e&&""!==e&&(a=e),"string"==typeof t&&""!==t&&(i=t);var o=a+" - "+i+"."+n;return{artist:a,title:i,filename:o}}function s(e){var t="";if(void 0!==e.common.picture&&e.common.picture.length>0){var r=new Blob([e.common.picture[0].data],{type:e.common.picture[0].format});t=URL.createObjectURL(r)}return t}},1:function(e,t){},2:function(e,t){},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("el-container",[r("el-main",[r("el-upload",{attrs:{"auto-upload":!1,"on-change":e.handleFile,"show-file-list":!1,action:"",drag:"",multiple:""}},[r("i",{staticClass:"el-icon-upload"}),r("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),r("em",[e._v("点击选择")])]),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("本工具仅在浏览器内对文件进行解锁，无需消耗流量")])]),r("el-row",{attrs:{id:"app-control"}},[r("el-row",{staticStyle:{"padding-bottom":"1em","font-size":"14px"}},[e._v(" 歌曲命名格式： "),r("el-radio",{attrs:{name:"format",label:"1"},model:{value:e.format,callback:function(t){e.format=t},expression:"format"}},[e._v("歌曲名")]),r("el-radio",{attrs:{name:"format",label:"2"},model:{value:e.format,callback:function(t){e.format=t},expression:"format"}},[e._v("歌手-歌曲名")]),r("el-radio",{attrs:{name:"format",label:"3"},model:{value:e.format,callback:function(t){e.format=t},expression:"format"}},[e._v("歌曲名-歌手")]),r("el-checkbox",{attrs:{border:""},model:{value:e.instantDownload,callback:function(t){e.instantDownload=t},expression:"instantDownload"}},[e._v("立即保存")])],1),r("el-button",{attrs:{icon:"el-icon-download",plain:""},on:{click:e.handleDownloadAll}},[e._v("下载全部")]),r("el-button",{attrs:{icon:"el-icon-delete",plain:"",type:"danger"},on:{click:e.handleDeleteAll}},[e._v("删除全部")])],1),r("audio",{attrs:{autoplay:e.playing_auto,src:e.playing_url,controls:""}}),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[r("el-table-column",{attrs:{label:"封面"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.row.picture}},[r("div",{staticClass:"image-slot el-image__error",attrs:{slot:"error"},slot:"error"},[e._v(" 暂无封面 ")])])]}}])}),r("el-table-column",{attrs:{label:"歌曲",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.title))])]}}])}),r("el-table-column",{attrs:{label:"歌手",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",[e._v(e._s(t.row.artist))])]}}])}),r("el-table-column",{attrs:{label:"专辑",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",[e._v(e._s(t.row.album))])]}}])}),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"success"},on:{click:function(r){return e.handlePlay(t.$index,t.row)}}}),r("el-button",{attrs:{circle:"",icon:"el-icon-download"},on:{click:function(r){return e.handleDownload(t.row)}}}),r("el-button",{attrs:{circle:"",icon:"el-icon-delete",type:"danger"},on:{click:function(r){return e.handleDelete(t.$index,t.row)}}})]}}])})],1)],1),r("el-footer",{attrs:{id:"app-footer"}},[r("el-row",[e._v(" 音乐解锁：移除已购音乐的加密保护。 目前支持网易云音乐(ncm)、QQ音乐(qmc, mflac, tkm)以及 "),r("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/README.md",target:"_blank"}},[e._v("其他格式")]),e._v("。 "),r("a",{attrs:{href:"https://github.com/ix64/unlock-music/wiki/使用提示",target:"_blank"}},[e._v("使用提示")])]),r("el-row",[r("span",[e._v("Copyright © 2019")]),r("a",{attrs:{href:"https://github.com/ix64",target:"_blank"}},[e._v("MengYX")]),e._v(" 音乐解锁使用 "),r("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/LICENSE",target:"_blank"}},[e._v("MIT许可协议")]),e._v(" 开放 "),r("a",{attrs:{href:"https://github.com/ix64/unlock-music",target:"_blank"}},[e._v("源代码")])])],1)],1)],1)},i=[],c=(r("4160"),r("a434"),r("b0c0"),r("d3b7"),r("3ca3"),r("159b"),r("ddb0"),r("2b3d"),r("bfa2")),o=r("bd2e"),s={name:"app",components:{},data:function(){var e=this;return{activeIndex:"1",tableData:[],playing_url:"",playing_auto:!1,format:"2",instantDownload:!1,workCount:0,cacheQueue:[],cacheQueueOption:{push:function(t){e.cacheQueue.push(t)},pop:function(){return e.cacheQueue.shift()},size:function(){return e.cacheQueue.length}},workers:[],idle_workers:[],thread_num:1}},mounted:function(){if(this.$nextTick((function(){this.finishLoad()})),""!==document.location.host){this.thread_num=Math.max(navigator.hardwareConcurrency,1);for(var e=0;e<this.thread_num;e++)this.workers.push(c().CommonDecrypt),this.idle_workers.push(e)}else this.workers.push(o.CommonDecrypt),this.idle_workers.push(0)},methods:{finishLoad:function(){document.getElementById("loader-mask").remove(),this.$notify.info({title:"离线使用",message:'我们使用PWA技术，无网络也能使用<br/>最近更新：支持bkcmp3/bkcflac/tkm<br/>点击查看 <a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:1e4,position:"top-left"})},handleFile:function(e){this.idle_workers.length>0?this.handleDoFile(e,this.idle_workers.shift()):this.cacheQueueOption.push(e)},handleCacheQueue:function(e){0!==this.cacheQueue.length?this.handleDoFile(this.cacheQueueOption.pop(),e):this.idle_workers.push(e)},handleDoFile:function(e,t){var r=this;this.workers[t](e).then((function(n){if(n.status){r.instantDownload?(r.handleDownload(n),r.handleDelete(null,n)):(r.tableData.push(n),r.$notify.success({title:"解锁成功",message:"成功解锁 "+n.title,duration:3e3}));var a=[n.title,n.artist,n.album];window._paq.push(["trackEvent","Unlock",n.rawExt+","+n.mime,JSON.stringify(a)])}else r.$notify.error({title:"出现问题",message:n.message+"，"+e.name+'，参考<a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:6e3}),window._paq.push(["trackEvent","Error",n.message,e.name]);r.handleCacheQueue(t)})).catch((function(n){console.error(n,e),window._paq.push(["trackEvent","Error",n,e.name]),r.handleCacheQueue(t)}))},handlePlay:function(e,t){this.playing_url=t.file,this.playing_auto=!0},handleDelete:function(e,t){URL.revokeObjectURL(t.file),URL.revokeObjectURL(t.picture),null!=e&&this.tableData.splice(e,1)},handleDownload:function(e){var t=document.createElement("a");switch(t.href=e.file,this.format){case"1":t.download=e.title+"."+e.ext;break;case"2":t.download=e.artist+" - "+e.title+"."+e.ext;break;case"3":t.download=e.title+" - "+e.artist+"."+e.ext;break;default:t.download=e.filename;break}document.body.append(t),t.click(),t.remove()},handleDeleteAll:function(){this.tableData.forEach((function(e){URL.revokeObjectURL(e.file),URL.revokeObjectURL(e.picture)})),this.tableData=[]},handleDownloadAll:function(){var e=this,t=0,r=setInterval((function(){t<e.tableData.length?(e.handleDownload(e.tableData[t]),t++):clearInterval(r)}),1e3)}}},u=s,l=(r("034f"),r("2877")),f=Object(l["a"])(u,a,i,!1,null,null,null),d=f.exports,p=r("9483");Object(p["a"])("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var m=r("5c96");r("0fae");n["default"].use(m["Link"]),n["default"].use(m["Image"]),n["default"].use(m["Button"]),n["default"].use(m["Table"]),n["default"].use(m["TableColumn"]),n["default"].use(m["Main"]),n["default"].use(m["Footer"]),n["default"].use(m["Container"]),n["default"].use(m["Icon"]),n["default"].use(m["Row"]),n["default"].use(m["Col"]),n["default"].use(m["Upload"]),n["default"].use(m["Checkbox"]),n["default"].use(m["Radio"]),n["default"].prototype.$notify=m["Notification"],n["default"].config.productionTip=!1,new n["default"]({render:function(e){return e(d)}}).$mount("#app")},"7cc0":function(e,t,r){"use strict";r.r(t),r.d(t,"Decrypt",(function(){return u}));r("cb29"),r("fb6a"),r("ace4"),r("d3b7"),r("3ca3"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("ddb0"),r("2b3d"),r("96cf");var n=r("d4ec"),a=r("bee2"),i=r("ade3"),c=r("1da1"),o=r("cb96"),s=r("06dc");function u(e,t,r){return l.apply(this,arguments)}function l(){return l=Object(c["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i,c,u,l,d,p,m,b,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("mflac"===n){e.next=2;break}return e.abrupt("return",{status:!1,message:"File type is incorrect!"});case 2:return e.next=4,s.GetArrayBuffer(t);case 4:if(a=e.sent,i=new Uint8Array(a.slice(0,-368)),c=i.length,u=new f,u.DetectMask(i)){e.next=10;break}return e.abrupt("return",{status:!1,message:"此音乐无法解锁，目前mflac格式不提供完整支持"});case 10:for(l=0;l<c;++l)i[l]^=u.NextMask();return d=new Blob([i],{type:"audio/flac"}),p=URL.createObjectURL(d),e.next=15,o.parseBlob(d);case 15:return m=e.sent,b=s.GetFileInfo(m.common.artist,m.common.title,r,"flac"),h=s.GetCoverURL(m),e.abrupt("return",{status:!0,filename:b.filename,title:b.title,artist:b.artist,ext:"flac",album:m.common.album,picture:h,file:p,mime:"audio/flac"});case 19:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}var f=function(){function e(){Object(n["a"])(this,e),Object(i["a"])(this,"FLAC_HEADER",[102,76,97,67,0]),this.index=-1,this.mask_index=-1,this.mask=Array(128).fill(0)}return Object(a["a"])(e,[{key:"DetectMask",value:function(e){for(var t,r=e.length-256,n=0;n<r;n+=128){var a=!0;t=e.slice(n,n+128);for(var i=e.slice(n+128,n+256),c=0;c<128;c++)if(t[c]!==i[c]){a=!1;break}if(a){for(var o=0;o<this.FLAC_HEADER.length;o++){var s=e[o]^t[o];if(s!==this.FLAC_HEADER[o]){a=!1;break}}if(a)return this.mask=t,!0}}return!1}},{key:"NextMask",value:function(){return this.index++,this.mask_index++,(32768===this.index||this.index>32768&&(this.index+1)%32768===0)&&(this.index++,this.mask_index++),this.mask_index>=128&&(this.mask_index-=128),this.mask[this.mask_index]}}]),e}()},"85ec":function(e,t,r){},a8ee:function(e,t,r){"use strict";r.r(t),r.d(t,"Decrypt",(function(){return o}));r("ace4"),r("d3b7"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("96cf");var n=r("1da1"),a=r("fd2f"),i=r("06dc"),c=[0,0,0,32,102,116,121,112];function o(e,t){return s.apply(this,arguments)}function s(){return s=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,o,s,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.GetArrayBuffer(t);case 2:for(n=e.sent,o=new Uint8Array(n),s=0;s<8;++s)o[s]=c[s];return u=new Blob([o],{type:"audio/mp4"}),e.next=8,a.Decrypt(u,r,"m4a");case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}},b6cf:function(e,t,r){"use strict";r.r(t),r.d(t,"Decrypt",(function(){return l}));r("ace4"),r("d3b7"),r("3ca3"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("ddb0"),r("2b3d"),r("96cf");var n=r("d4ec"),a=r("bee2"),i=r("1da1"),c=r("cb96"),o=r("06dc"),s=[[74,214,202,144,103,247,82],[94,149,35,159,19,17,126],[71,116,61,144,170,63,81],[198,9,213,159,250,102,249],[243,214,161,144,160,247,240],[29,149,222,159,132,17,244],[14,116,187,144,188,63,146],[0,9,91,159,98,102,161]],u={qmc0:"mp3",qmc3:"mp3",qmcogg:"ogg",qmcflac:"flac",bkcmp3:"mp3",bkcflac:"flac",tkm:"m4a"};function l(e,t,r){return f.apply(this,arguments)}function f(){return f=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i,s,l,f,p,m,b,h,g,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n in u){e.next=2;break}return e.abrupt("return",{status:!1,message:"File type is incorrect!"});case 2:return a=u[n],i=o.AudioMimeType[a],e.next=6,o.GetArrayBuffer(t);case 6:for(s=e.sent,l=new Uint8Array(s),f=new d,p=0;p<l.length;++p)l[p]^=f.NextMask();return m=new Blob([l],{type:i}),b=URL.createObjectURL(m),e.next=14,c.parseBlob(m);case 14:return h=e.sent,g=o.GetFileInfo(h.common.artist,h.common.title,r,a),v=o.GetCoverURL(h),e.abrupt("return",{status:!0,filename:g.filename,title:g.title,artist:g.artist,ext:a,album:h.common.album,picture:v,file:b,mime:i});case 18:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}var d=function(){function e(){Object(n["a"])(this,e),this.x=-1,this.y=8,this.dx=1,this.index=-1}return Object(a["a"])(e,[{key:"NextMask",value:function(){var e;return this.index++,this.x<0?(this.dx=1,this.y=(8-this.y)%8,e=195):this.x>6?(this.dx=-1,this.y=7-this.y,e=216):e=s[this.y][this.x],this.x+=this.dx,32768===this.index||this.index>32768&&(this.index+1)%32768===0?this.NextMask():e}}]),e}()},bd2e:function(e,t,r){"use strict";r.r(t),r.d(t,"CommonDecrypt",(function(){return u}));r("baa5"),r("b0c0"),r("96cf");var n=r("1da1"),a=r("dde9"),i=r("b6cf"),c=r("fd2f"),o=r("7cc0"),s=r("a8ee");function u(e){return l.apply(this,arguments)}function l(){return l=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.name.substring(t.name.lastIndexOf(".")+1,t.name.length).toLowerCase(),n=t.name.substring(0,t.name.lastIndexOf(".")),e.t0=r,e.next="ncm"===e.t0?5:"mp3"===e.t0?9:"flac"===e.t0?9:"m4a"===e.t0?9:"ogg"===e.t0?9:"tm0"===e.t0?13:"tm3"===e.t0?13:"qmc3"===e.t0?17:"qmc0"===e.t0?17:"qmcflac"===e.t0?17:"qmcogg"===e.t0?17:"tkm"===e.t0?17:"bkcmp3"===e.t0?17:"bkcflac"===e.t0?17:"mflac"===e.t0?21:"tm2"===e.t0?25:"tm6"===e.t0?25:29;break;case 5:return e.next=7,a.Decrypt(t.raw);case 7:return u=e.sent,e.abrupt("break",30);case 9:return e.next=11,c.Decrypt(t.raw,n,r);case 11:return u=e.sent,e.abrupt("break",30);case 13:return e.next=15,c.Decrypt(t.raw,n,"mp3");case 15:return u=e.sent,e.abrupt("break",30);case 17:return e.next=19,i.Decrypt(t.raw,n,r);case 19:return u=e.sent,e.abrupt("break",30);case 21:return e.next=23,o.Decrypt(t.raw,n,r);case 23:return u=e.sent,e.abrupt("break",30);case 25:return e.next=27,s.Decrypt(t.raw,n);case 27:return u=e.sent,e.abrupt("break",30);case 29:u={status:!1,message:"不支持此文件格式"};case 30:return u.status&&(u.rawExt=r,u.rawFilename=n),e.abrupt("return",u);case 32:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}},bfa2:function(e,t,r){var n=r("3d67"),a=["CommonDecrypt"];e.exports=function(){var e=new Worker(r.p+"8b126b536261429f52a1.worker.js",{name:"[hash].worker.js"});return n(e,a),e}},dde9:function(e,t,r){"use strict";r.r(t),r.d(t,"Decrypt",(function(){return l}));r("4160"),r("a15b"),r("d81d"),r("fb6a"),r("ace4"),r("d3b7"),r("ac1f"),r("25f0"),r("3ca3"),r("5319"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("159b"),r("ddb0"),r("2b3d");var n=r("3835"),a=(r("96cf"),r("1da1")),i=r("3452"),c=r("7907"),o=r("06dc"),s=i.enc.Hex.parse("687a4852416d736f356b496e62617857"),u=i.enc.Hex.parse("2331346C6A6B5F215C5D2630553C2728");function l(e){return f.apply(this,arguments)}function f(){return f=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,a,i,c,s,u,l,f,p,g,v,y,w,k,x,_,D,R,A,O;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o.GetArrayBuffer(t);case 2:if(r=e.sent,a=new DataView(r),1313166403===a.getUint32(0,!0)&&1296122950===a.getUint32(4,!0)){e.next=6;break}return e.abrupt("return",{status:!1,message:"此ncm文件已损坏"});case 6:for(i=m(a,r,10),c=b(i.data),s=h(a,r,i.offset),u=s.data,l=s.offset+a.getUint32(s.offset+5,!0)+13,f=new Uint8Array(r,l),p=0;p<f.length;++p)f[p]^=c[255&p];if(void 0===u.format&&(g=f,v=Object(n["a"])(g,4),y=v[0],w=v[1],k=v[2],x=v[3],u.format=102===y&&76===w&&97===k&&67===x?"flac":"mp3"),_=o.AudioMimeType[u.format],D=[],u.artist.forEach((function(e){D.push(e[0])})),"mp3"!==u.format){e.next=21;break}return e.next=20,d(f,D,u.musicName,u.album,u.albumPic);case 20:f=e.sent;case 21:return R=new Blob([f],{type:_}),A=URL.createObjectURL(R),O=D.join(" & ")+" - "+u.musicName+"."+u.format,e.abrupt("return",{status:!0,filename:O,title:u.musicName,artist:D.join(" & "),ext:u.format,album:u.album,picture:u.albumPic,file:A,mime:_});case 25:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function d(e,t,r,n,a){return p.apply(this,arguments)}function p(){return p=Object(a["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i){var o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=new c(t),o.setFrame("TPE1",r).setFrame("TIT2",n).setFrame("TALB",a),""===i){e.next=15;break}return e.prev=3,e.next=6,fetch(i);case 6:return e.next=8,e.sent.arrayBuffer();case 8:s=e.sent,o.setFrame("APIC",{type:3,data:s,description:"Cover"}),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](3),console.log("Fail to write cover image!");case 15:return o.addTag(),e.abrupt("return",o.arrayBuffer);case 17:case"end":return e.stop()}}),e,null,[[3,12]])}))),p.apply(this,arguments)}function m(e,t,r){var n=e.getUint32(r,!0);r+=4;var a=new Uint8Array(t,r,n).map((function(e){return 100^e}));r+=n;for(var c=i.AES.decrypt({ciphertext:i.lib.WordArray.create(a)},s,{mode:i.mode.ECB,padding:i.pad.Pkcs7}),o=new Uint8Array(c.sigBytes),u=c.words,l=c.sigBytes,f=0;f<l;f++)o[f]=u[f>>>2]>>>24-f%4*8&255;return{offset:r,data:o.slice(17)}}function b(e){for(var t=new Uint8Array(Array(256).keys()),r=e.length,n=0,a=0;a<256;a++){n=t[a]+n+e[a%r]&255;var i=[t[n],t[a]];t[a]=i[0],t[n]=i[1]}return t.map((function(e,t,r){t=t+1&255;var n=r[t],a=r[t+n&255];return r[n+a&255]}))}function h(e,t,r){var n=e.getUint32(r,!0);if(r+=4,0===n)return{};var a=new Uint8Array(t,r,n).map((function(e){return 99^e}));r+=n;var c=i.AES.decrypt({ciphertext:i.enc.Base64.parse(i.lib.WordArray.create(a.slice(22)).toString(i.enc.Utf8))},u,{mode:i.mode.ECB,padding:i.pad.Pkcs7}),o=JSON.parse(c.toString(i.enc.Utf8).slice(6));return o.albumPic=o.albumPic.replace("http:","https:"),{data:o,offset:r}}},fd2f:function(e,t,r){"use strict";r.r(t),r.d(t,"Decrypt",(function(){return c}));r("d3b7"),r("3ca3"),r("ddb0"),r("2b3d"),r("96cf");var n=r("1da1"),a=r("cb96"),i=r("06dc");function c(e,t,r){return o.apply(this,arguments)}function o(){return o=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var c,o,s,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.parseBlob(t);case 2:return c=e.sent,o=URL.createObjectURL(t),s=i.GetCoverURL(c),u=i.AudioMimeType[n],l=i.GetFileInfo(c.common.artist,c.common.title,r,n),e.abrupt("return",{status:!0,filename:l.filename,title:l.title,artist:l.artist,ext:n,album:c.common.album,picture:s,file:o,mime:u});case 8:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}}});
//# sourceMappingURL=app-legacy.5be9dc93.js.map